

# ADR-002: Deploy mediante Git Hooks y sudoers NOPASSWD

## Contexto
Beholder necesita un mecanismo de despliegue simple y confiable para actualizar código en producción.  
Las opciones consideradas fueron:
- **CI/CD externo** (GitHub Actions, GitLab CI, Jenkins): más potente pero requiere infraestructura adicional.  
- **Deploy manual vía SSH**: flexible pero propenso a errores humanos.  
- **Git hooks en el servidor**: automatizan el proceso al recibir un `git push`.  

El sistema corre en servidores propios del ISP, con usuarios técnicos limitados y necesidad de rapidez en cambios.

## Decisión
Se decidió implementar **deploy automático mediante git hooks** en el repositorio remoto, combinados con reglas en `sudoers` para permitir reinicios de servicios sin contraseña.  
Motivos:
- Simplicidad: un `git push production main` actualiza y reinicia el servicio.  
- Bajo costo: no requiere infraestructura adicional ni pipelines externos.  
- Control local: todo corre en el servidor del ISP, sin depender de terceros.  
- Seguridad: `sudoers` limita los comandos permitidos (solo `systemctl reload nginx` y `systemctl restart beholder.service`).

## Consecuencias
**Positivas:**
- Deploy rápido y reproducible.  
- Menor riesgo de olvidar pasos manuales.  
- Operadores pueden actualizar sin conocimientos avanzados de Linux.  

**Negativas:**
- Menor flexibilidad que un pipeline CI/CD (no hay tests automáticos).  
- Riesgo de que un hook mal escrito rompa el deploy.  
- Escalabilidad limitada si se agregan múltiples servidores.  

**Mitigación:**
- Documentar el hook y mantenerlo versionado.  
- Usar `sudoers` con comandos específicos para evitar abusos.  
- Planear migración futura a CI/CD cuando el equipo crezca.  

